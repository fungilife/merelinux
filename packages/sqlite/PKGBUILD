#!/bin/bash
# shellcheck disable=SC2034,SC2154,SC2068
# Maintainer: Jeremy Huntwork <jhuntwork@lightcubesolutions.com>

pkgname=(sqlite libsqlite libsqlite-dev)
pkgver=3.34.1
_pkgaltver=3340100
pkgrel=1
pkgdesc='A self-contained embedded SQL database engine.'
arch=('x86_64')
url='https://sqlite.org/'
license=(PublicDomain)
groups=('base')
depends=()
makedepends=(readline-dev)
options=()
changelog=ChangeLog

source=(
    "https://sqlite.org/2021/sqlite-autoconf-${_pkgaltver}.tar.gz"
)

sha256sums=(
    2a3bca581117b3b88e5361d0ef3803ba6d8da604b1c1a47d902ef785c1b53e89
)


build() {
    cd_unpacked_src
    CFLAGS+=' -fPIC -DSQLITE_ENABLE_FTS3=1 -DSQLITE_ENABLE_COLUMN_METADATA=1'
    CFLAGS+=' -DSQLITE_ENABLE_UNLOCK_NOTIFY=1 -DSQLITE_SECURE_DELETE=1'
    export CFLAGS+=' -DSQLITE_ENABLE_DBSTAT_VTAB=1 --static'
    ./configure --prefix=''
    make
}

package_sqlite() {
    pkgfiles=(
        bin
        share/man/man1
    )
    std_package
}

package_libsqlite() {
    pkgfiles=(
        lib/*.so.*
    )
    depends=(
        musl
        readline
    )
    std_split_package
}

package_libsqlite-dev() {
    pkgfiles=(
        include
        lib/*.a
        lib/*.so
        lib/pkgconfig
    )
    depends=(
        libsqlite
    )
    std_split_package
}
