#!/bin/bash
# shellcheck disable=SC2034,SC2154,SC2068
# Maintainer: Jeremy Huntwork <jeremy@merelinux.org>

pkgname=(mdevd)
pkgver=0.1.4.0
pkgrel=2
pkgdesc='A small daemon managing kernel hotplug events, similarly to udevd.'
arch=(x86_64)
url='http://skarnet.org/software/mdevd/'
license=(ISC)
groups=(base)
depends=()
makedepends=(skalibs-dev)
options=()
changelog=ChangeLog
source=(
    "http://skarnet.org/software/mdevd/mdevd-${pkgver}.tar.gz"
    mdev.conf
    catch-all
    dev-bus-usb
    settle-nics
    sound-control
    storage-device
)

sha256sums=(
    ffd3b223b4cf0e51253b4a8f09cb88d70bf22693228ab0818af174a3f099dcd2
    a3cd52e38bdfac9e27f0c82cf63f518c1136518dd978cfa4fe6ce104be56c1f8
    f9d22d7f00522076c421a2c39c48057e799409c799e825b7e177237eac3723b3
    0273c88a88eb057dabc6fe59ed563c5ad8e0eb8d39ef36f56f3484f4bfa8f959
    a55b5b27b2773c5442667e7db4e46ce131b67c78688c73f123e8531dc2384212
    4592e04a9b0d8f8492f351d305b43057e302163dbf25cc255e618fafd4ad5bc3
    b5d2b3b66ac683fc8b17dabf8fada623541441c0131241d56b0066d24933b568
)

backup=(etc/mdev.conf)

build() {
    cd_unpacked_src
    ./configure \
      --prefix=/ \
      --bindir=/sbin \
      --enable-static-libc
    make
}

package() {
    pkgfiles=(
        sbin
    )
    std_package
    install -d "${pkgdir}/etc" "${pkgdir}/lib/mdev/helpers"
    install -m0644 "${srcdir}/mdev.conf" "${pkgdir}/etc/mdev.conf"
    install -m0754 "${srcdir}/catch-all"      "${pkgdir}/lib/mdev/helpers/"
    install -m0754 "${srcdir}/dev-bus-usb"    "${pkgdir}/lib/mdev/helpers/"
    install -m0754 "${srcdir}/settle-nics"    "${pkgdir}/lib/mdev/helpers/"
    install -m0754 "${srcdir}/sound-control"  "${pkgdir}/lib/mdev/helpers/"
    install -m0754 "${srcdir}/storage-device" "${pkgdir}/lib/mdev/helpers/"
}
