#!/bin/bash
# shellcheck disable=SC2034,SC2154,SC2068
# Maintainer: Jeremy Huntwork <jhuntwork@lightcubesolutions.com>

rationale='Perl is a build and runtime dependency of the autoconf and automake tools'
pkgname=(perl)
pkgver=5.32.1
pkgrel=1
pkgdesc='An API for writing text-based user interfaces.'
arch=('x86_64')
url='http://www.perl.org'
license=('GPL2')
groups=('base')
depends=(musl)
makedepends=(zlib-dev)
options=()
changelog=ChangeLog

source=(
    "http://www.cpan.org/src/5.0/perl-${pkgver}.tar.xz"
)
sha256sums=(
    57cc47c735c8300a8ce2fa0643507b44c4ae59012bfdad0121313db639e02309
)


build() {
    cd_unpacked_src
    grep -lr "/usr" . | xargs sed -i -e 's@/usr/local@@g' -e 's@/usr@@g'
    export BUILD_ZLIB=False
    CFLAGS="$CFLAGS" ./configure.gnu \
      -des -Dprefix=/ \
      -Dcc="cc -D_GNU_SOURCE" \
      -Dbin=/bin \
      -Dinstallsitebin=/bin \
      -Dvendorprefix=/ \
      -Dprivlib=/lib/perl5/${pkgver} \
      -Darchlib="/lib/perl5/${pkgver}/$(arch)-linux" \
      -Dsitelib=/lib/perl5/site_perl/${pkgver} \
      -Dvendorlib=/lib/perl5/vendor_perl/${pkgver} \
      -Dvendorarch="/lib/perl5/vendor_perl/${pkgver}/$(arch)-linux" \
      -Dscriptdir=/bin \
      -Dsitescript=/bin \
      -Dvendorbin=/bin \
      -Dvendorscript=/bin \
      -Dman1dir=/share/man/man1 \
      -Dman3dir=/share/man/man3 \
      -Dpager="/bin/less -I" \
      -Dusethreads \
      -Duseshrplib
    make
}

check() {
    cd_unpacked_src
    # make test
}

package() {
    pkgfiles=(
        bin
        lib
        share
    )
    std_package
}
